# Nonogram Solver - C++

A Nonogram solver in C++. See the Wikipeida [article][nonogram_wiki].

[nonogram_wiki]: https://en.wikipedia.org/wiki/Nonogram 

Run "main.exe --help" on the cmd line to see options.


## Algorithm 
### Complete solver
Based on ideas by [Rosetta Code][rosetta_code].

Algorithm
- generate all possible rows and columns. This is done using unique integr partition permutations. This is very slow and memory intenstive.
- do row and column sweeps
	- discard possible rows/columns which do not fit in the current puzzle.
	- determine if there are any cells that are the same colour in all possibilities. 
- if there are more than 1 possible row/column after constraint propagation, try place possible rows, and see if all possible columns fit. This can be very slow and memory intenstive. 

### Fast solver
Based on ideas by [Jan Wolter][Wolter_survey] and [Steve Simpson][lancaster_solver].
Algorithm
- do constraint propagation with row and column sweeps
	- find the left-most and right-most match for each row/column. This is done using a Nondeterministic Finite State Machine and Thompsons algorithm. This is an O(n^2) algorithm. See my blog [post][nfa_post] for more detail.
	- find intersections. This is done by finding a "changer sequence". See the example below. It is made by replacing each symbol with a counter which increments everytime the symbols change e.g. from BLACK to WHITE. Counter values which are in the same index in both left and right are overlaps.
	- a simple filler which adds very simple clues that the left-right algorithm sometimes misses e.g. a white after ending a black sequence.
- if this fails, guess and then go back to constraint propagation
	- first try to find find contradictions -> guesses which are obviously wrong. This will happen if there are no matches for the line matcher. The opposite guess is therefore true.
	- otherwise save the current grid and make a binary guess. Backtrack if it is wrong. This is O(2^n), so it can very easily lead down a never ending spiral of guesses. 

<pre>
Example by [Steve Simpson][lancaster_fast]:	<br>
Length:   24 <br>
Rule:     1,1,5 <br>
Original: >---#---------#-----#####< <br>
Broken:   >---#--         -      # < <br>
      left>000122344444444444555556< <br>
     right>000122222222222223455555< <br>
      fast>---#--+++++++++-+++####+< <br>
</pre>

[Wolter_survey]: https://webpbn.com/survey/
[lancaster_solver]: http://scc-forge.lancaster.ac.uk/open/nonogram/
[lancaster_fast]: http://scc-forge.lancaster.ac.uk/open/nonogram/ls-fast
[rosetta_code]: https://rosettacode.org/wiki/Nonogram_solver
[nfa_post]: https://liorsinai.github.io/coding/2020/10/29/finite-state-machines.html

## Input files

### Solve collection
Solve a collection of puzzles in a single file.

Format is:
---
<div>
General description (this line is skipped by the file reader) <br>
-- puzzle title (this line is skipped by the file reader)<br>
[run rows] <br>
[run cols] <br>
-- next puzzle title (this line is skipped by the file reader) <br>
... <br>
--- 
</div>

The runs are given by sets of unicode characters, with A=1, B=2 and so on. Spaces represent a new row/column.
This can work for a numbers greater than 26, but these will be encoded as non-Basic Latin unicode symbols.

### Solve puzzle
Based on Steve Simpsons .non format.

Format is:

---
<div>
text    (this line is skipped by the file reader) <br>
title  (this line is skipped by the file reader) <br>

width w (this line is skipped by the file reader) <br>
height h (this line is skipped by the file reader) <br>

rows  <br>
x, x, x <br>
.... <br>

columns <br>
x, x, x <br>
... <br>
</div>

---

## Example solutions
Elephant, 15x15, solved in 0.012s
<pre>
-  -  -  -  -  -  03 -  -  -  01 -  -  -  -  -  -  -  -  <br> 
-  -  -  -  -  -  03 07 -  -  05 02 -  -  01 01 01 01 -  <br>
-  -  -  -  01 11 01 02 07 15 07 08 14 09 06 09 09 10 12 <br>
-  -  -  03 .  .  .  .  .  #  #  #  .  .  .  .  .  .  . <br>
-  -  04 02 .  .  #  #  #  #  .  #  #  .  .  .  .  .  . <br>  
-  -  06 06 .  #  #  #  #  #  #  .  #  #  #  #  #  #  . <br>
-  06 02 01 .  #  #  #  #  #  #  .  #  #  .  .  .  .  # <br>
01 04 02 01 .  #  .  #  #  #  #  .  #  #  .  .  .  .  # <br>
-  06 03 02 .  #  #  #  #  #  #  .  #  #  #  .  .  #  # <br>
-  -  06 07 .  #  #  #  #  #  #  .  #  #  #  #  #  #  # <br>
-  -  06 08 #  #  #  #  #  #  .  #  #  #  #  #  #  #  # <br>
-  -  01 10 .  #  .  .  .  #  #  #  #  #  #  #  #  #  # <br>
-  -  01 10 .  #  .  .  .  #  #  #  #  #  #  #  #  #  # <br>
-  -  01 10 .  #  .  .  .  #  #  #  #  #  #  #  #  #  # <br>
01 01 04 04 .  #  .  #  .  #  #  #  #  .  .  #  #  #  # <br>
-  03 04 04 .  #  #  #  .  #  #  #  #  .  .  #  #  #  # <br>
-  -  04 04 .  .  .  .  .  #  #  #  #  .  .  #  #  #  # <br>  
-  -  04 04 .  .  .  .  .  #  #  #  #  .  .  #  #  #  # <br>
</pre>

"Where there is smoke", solved in 0.154s with 12 guesses:
<div>
<pre>
- -  -  -  -  -  -  -  -  -  -  01 -  -  -  -  -  -  -  -  -  -  -  -  -  - <br>
- -  -  -  -  -  -  -  03 -  -  01 02 -  03 -  -  -  -  -  -  -  -  -  -  - <br>
- -  -  -  -  -  -  01 03 -  01 01 01 02 01 01 -  -  -  -  -  03 -  -  -  - <br>
- -  -  -  -  -  02 06 01 -  03 02 01 04 02 04 03 02 -  -  -  02 03 -  -  01 <br>
- -  -  -  -  -  02 04 01 02 03 01 01 03 03 02 01 01 03 07 05 01 04 09 08 08 <br>
- -  -  -  -  -  01 04 04 02 03 02 01 03 01 01 02 01 03 04 04 03 01 02 03 02 <br>
- -  01 03 02 01 .  #  .  #  #  #  .  .  #  #  .  .  .  .  .  .  .  .  .  #<br>
- -  -  01 02 02 #  .  #  #  .  .  .  #  #  .  .  .  .  .  .  .  .  .  .  .<br>
- -  -  -  03 04 #  #  #  .  .  .  #  #  #  #  .  .  .  .  .  .  .  .  .  .<br>
- -  -  02 03 02 .  #  #  .  #  #  #  .  .  #  #  .  .  .  .  .  .  .  .  .<br>
- -  -  02 01 06 #  #  .  .  #  .  .  .  .  #  #  #  #  #  #  .  .  .  .  .<br>
- -  -  02 13 01 #  #  .  .  #  #  #  #  #  #  #  #  #  #  #  #  #  .  .  #<br>
- -  -  01 01 08 .  #  .  .  .  .  .  #  .  .  .  .  #  #  #  #  #  #  #  #<br>
- -  02 01 01 07 .  #  #  .  .  .  .  #  .  #  .  .  .  #  #  #  #  #  #  #<br>
- 01 02 02 02 03 .  .  #  .  .  .  #  #  .  #  #  .  .  #  #  .  .  #  #  #<br>
- 03 01 01 01 03 #  #  #  .  .  #  .  .  .  .  .  .  .  #  .  #  .  #  #  #<br>
- 01 02 01 01 03 .  #  .  .  #  #  .  .  .  .  .  .  .  #  .  #  .  #  #  #<br>
- -  02 01 01 03 .  #  #  .  #  .  .  .  #  .  .  .  .  .  .  .  .  #  #  #<br>
- -  -  01 05 05 .  #  .  .  #  #  #  #  #  .  .  .  .  .  .  #  #  #  #  #<br>
- -  -  01 01 03 .  .  #  .  .  .  .  #  .  .  .  .  .  .  .  .  #  #  #  .<br>
- -  -  -  04 02 .  .  .  .  .  #  #  #  #  .  .  .  .  .  .  .  #  #  .  .<br>
- 02 02 01 02 01 .  #  #  .  #  #  .  .  #  .  .  .  .  .  .  #  #  .  .  #<br>
- 02 01 02 03 02 .  #  #  .  #  .  .  #  #  .  .  .  .  #  #  #  .  .  #  #<br>
- -  04 01 06 01 .  #  #  #  #  .  .  #  .  .  #  #  #  #  #  #  .  .  #  .<br>
- -  03 04 03 02 .  #  #  #  .  .  .  #  #  #  #  .  #  #  #  .  .  #  #  .<br>
- -  -  -  04 02 .  .  .  .  .  .  .  .  .  .  .  #  #  #  #  .  #  #  .  .<br>
</pre>
</div>


Lost, 78x78, solved in 1.6s:
<div>
<pre>
- # . . # # # . . . # # . # # . . . # # # . # # . # # . # # . . # # . # # # . # # . . # # # . # # # . # # # . . # # # . # # . # # # . . # # . . . # # . # # #<br>
- # . # # . # # # . . # # # . # # . # # # . # # . . # # # . # # . # # # . . . # # . # # . . # # # . # # . . . # # . # # # . # # # . # # # . # # # . . # # # .<br>
- . . . . # # . # # # . # # . # # . . . # # # . # # . . # # . . # # . # # . # # . # # # . . # # . . # # . # # # . # # . . . # # . # # . # # . . # # . . # . #<br>
- # # # . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . # #<br>
- # # # . # . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . # # # # #<br>
- # . . . # . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . # . # # .<br>
- . # # . # . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . # # # # . . . . . . . . . . . . . . . . . . . . . . . . . . . . . # . # . .<br>
- # # # . # . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . . # . . . #<br>
- # . . # # . . . . . . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # #<br>
- . # # # # . . . . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # # .<br>
- . # # # # . . . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # . #<br>
- # . # . # . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # . # # # # # # . . . . . . . . . . . . . . . . . . . . . # . . # #<br>
- # # . # # . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # . . . # # # # # # # . . . . . . . . . . . . . . . . . . . # # # # #<br>
- # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # . . # # # # # # # . . . . . . . . . . . . . . . . . . . # # # . .<br>
- . # # . # . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . # # # # #<br>
- # . . # # # # # # . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . # . . # #<br>
- # . . # # # # # # # . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . # # # . .<br>
- . . # # # # # # # # # . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . # # # # .<br>
- . # # . . # # # # # # # # . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . # # . # #<br>
- # # . # # # # # # # # # # # . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . # . . . #<br>
- # # # # # # # # # # # # # # # # # . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . # . # . #<br>
- . . # . . . . # # # # # # # # # # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . # # # # .<br>
- . # . # . . . . . # # # # # # # # # # . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . # # # # #<br>
- # # . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . # . . . #<br>
- # # # # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . # # # . #<br>
- . . # . # . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . # # # # .<br>
- # # # # # . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . # # # # # . . . . . . . # # # # #<br>
- # # . # # . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . # # # # # . . . . . . . # . . # #<br>
- . . # . # . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . # # # # # # . . . . . . # # # . #<br>
- # # # . # . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . # # # # # # # . . . . . # # # # .<br>
- # # # # # . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . # # # # # # # # . . . . # . # # .<br>
- . . . # # . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . # # # # # # # # # # # # # . . . #<br>
- # # # . # . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . # # # # # # # # # # # . # . # . #<br>
- # # # # # . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . # # # # # # # # . . . . # # # . #<br>
- . # . # # . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . # # # # # # # # # . . . . # # . # .<br>
- . . . # # . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # . # . # # #<br>
- . # . . # . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # # # # # . . . . . . # # # . #<br>
- # # # . # . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . # # # . . . . . . . . # # # # # # # # # . . . . . . . # # . # .<br>
- # # # # # . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . # # . . . . . . . . . # # # # # # # . . . . . . . # . . # .<br>
- . . . # # . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # . . . # # # . .<br>
- . . # . # . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . # . . # # # # # # # # # # # . . . # # # . #<br>
- # # # # # . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . # # # . . . . . . . . # # # . # # # # # # # # # # # # # # # . . . #<br>
- # # . # # . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # . . . . . # # # # .<br>
- . . . . # . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # . . . . . # # # # #<br>
- # # . . # . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # . . . . . . # . . # #<br>
- # # . # # . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # . . . . # # . # . #<br>
- . # # # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # . . . . # . # # # .<br>
- # . # # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # . . . . # # # . # #<br>
- # . # . # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # . . . . . . # # . # . #<br>
- . # . # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . . . # # # # # # # . . . . . . # # . # # #<br>
- . # # # # . . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . # # # . . . . . # # # # # # # # # . . . . # # # # . # .<br>
- # # # . # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . # # . . . # # # # # # # # # # # . . . # # # # # . #<br>
- # . . . # # . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . # . . . . # # # # # # # # # # # # # # # # # . # . #<br>
- # # # # # # . . # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # .<br>
- . # # # # # . . . # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # . # .<br>
- # # # . # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . # # # # # # # # # . # # # # # # # # # # # # # # # # # # # # . . #<br>
- # . . # # . . . . . # # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . # # # # . . . # # # # # # # # # # # # # # # # # # # . . . #<br>
- # # # # # . . . . . . # # # # # # # # # # # # # # # # # # # # # # . . . # . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # . # # .<br>
- . # # # # . . . . . . . . # # # # # # # # # # # # # # # # # # # # . . . . # . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # #<br>
- # . . . # # . . . . . . . # # # # # # # # # # # # # # # # # # # . . . . # # . . . . . . . . . . . # # # . # # # # # # # # # # # # # # # # # # # # # # # . #<br>
- # . # # # . . . . . . . # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # . . # #<br>
- # # # # # . . . . . . . # # # # # # # # # # # # # # # # # # # . . . . . . . . # # . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # .<br>
- . # # # # . . . . . . # # # # # # # # # # # # # # # # # # # # . . . . . . . . # # # # . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # . .<br>
- . # . . # # # . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # #<br>
- # . # . # # # . . # # # # # # # # # # # # # # # # # # # # # # . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . # #<br>
- # # # # # # . . # # # # # # # # # # # # # # # # # # . . . # # # . . . . . . . . . . # # # . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # . #<br>
- . # . # # . . . # # # # # # # # # # # # # # # # # . . . . # # . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . .<br>
- # # . # # # . . # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # . # # .<br>
- # . # . # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . . . . . . # # # . . . # # # # # # # # # # # # # # # # # # # . . . . # #<br>
- . # # # # # # # # # # # # # # # # # # # # # # # . . . . . . . . . . . . . . . . . # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . # #<br>
- # # . # # # # # # # # # # # # # # # # # # # # # . . . . . # # . . . . . . . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . #<br>
- # # . . # # # # # # # # # # # # # # # # # # # # . . . . . # # # # # # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . .<br>
- . . # . # # # # # # # # # # # # # # # # # # # # . . . . # # # # # # # # . . . . # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # . . # .<br>
- # . # . # # . # # # . # # . . # # . . # # . # # . # # . # # . . . # # # . # # # . . # # # . # # # . # # # . . # # . # # # . # # . . # # . # # # . # # # # #<br>
</pre>
</div>
